<div class="flex flex-wrap justify-content align-items-center pb-2">
	<button
		pButton
		type="button"
		label="Adicionar"
		icon="pi pi-plus"
		class="p-button-success"
		size="small"
		(click)="showDialog()"
	></button>
</div>
<p-panel>
	<ng-template pTemplate="header"> </ng-template>
	<p-table
		[value]="events"
		[paginator]="true"
		[rows]="10"
		[first]="first"
		[showCurrentPageReport]="true"
		[tableStyle]="{ 'min-width': '50rem' }"
		currentPageReportTemplate="{first} a {last} de {totalRecords} registros"
		(onPage)="pageChange($event)"
		[rowsPerPageOptions]="[10, 25, 50]"
		[className]="'event-table'"
	>
		<ng-template #header>
			<tr>
				<th class="text-center">Ex-Date</th>
				<th class="text-center">Pay-Date</th>
				<th class="text-center">Ativo</th>
				<th class="text-center">Tipo</th>
				<th class="text-center">Corretora</th>
				<th class="text-center">Valor por Cota</th>
				<th class="text-center">Valor Total</th>
				<th class="text-center">Moeda</th>
				<th class="text-center">Notas</th>
				<th class="text-center">Ações</th>
			</tr>
		</ng-template>
		<ng-template #body let-event>
			<tr>
				<td class="text-center">{{ event.exDate | date: 'dd/MM/yyyy' }}</td>
				<td class="text-center">{{ event.payDate | date: 'dd/MM/yyyy' }}</td>
				<td class="text-center">{{ event.asset?.ticker }}</td>
				<td class="text-center">{{ getEventTypeLabel(event.type) }}</td>
				<td class="text-center">{{ event.broker?.name }}</td>
				<td class="text-center">{{ event.valuePerShare | currency: event.currency : 'symbol' : '1.2-6' }}</td>
				<td class="text-center">{{ event.totalValue | currency: event.currency : 'symbol' : '1.2-2' }}</td>
				<td class="text-center">{{ event.currency }}</td>
				<td class="text-center">{{ event.notes }}</td>
				<td class="text-center">
					<div class="flex items-center justify-center gap-1">
						<button
							pButton
							type="button"
							icon="pi pi-trash"
							class="p-button-danger p-button-sm"
							(click)="confirmDelete(event.id)"
						></button>
						<button
							pButton
							type="button"
							icon="pi pi-pencil"
							class="p-button-warning p-button-sm ml-2"
							(click)="editEvent(event)"
						></button>
					</div>
				</td>
			</tr>
		</ng-template>
		<ng-template #emptymessage>
			<tr>
				<td colspan="10" class="flex-row justify-content-center align-items-center text-center w-full">
					<i class="pi pi-info-circle" style="font-size: 2rem; color: var(--p-primary-color)"></i>
					<h3 class="w-full text-center">Nenhum evento encontrado.</h3>
				</td>
			</tr>
		</ng-template>
	</p-table>
</p-panel>

<p-dialog
	header="Adicionar evento financeiro"
	[(visible)]="visible"
	[modal]="true"
	[draggable]="true"
	[resizable]="true"
	styleClass="w-full lg:w-6"
>
	<form [formGroup]="eventForm" class="formgrid grid pt-2">
		<div class="field col-12 md:col-6 pt-3">
			<p-floatlabel class="w-full md:w-56">
				<p-select
					formControlName="asset"
					inputId="asset"
					[options]="assetOptions"
					optionLabel="ticker"
					[virtualScroll]="true"
					[lazy]="true"
					[filter]="true"
					[loading]="loadingAssets"
					[virtualScrollItemSize]="40"
					[showClear]="true"
					class="w-full"
				></p-select>
				<label for="asset">Ativo</label>
			</p-floatlabel>
		</div>
		<div class="field col-12 md:col-6 pt-3">
			<p-float-label>
				<p-select
					formControlName="type"
					[options]="eventTypes"
					class="w-full"
				></p-select>
				<label for="type">Tipo</label>
			</p-float-label>
		</div>
		<div class="field col-12 md:col-6 pt-3">
			<p-floatlabel class="w-full md:w-56">
				<p-select
					formControlName="broker"
					inputId="broker"
					[options]="brokerOptions"
					optionLabel="name"
					[virtualScroll]="true"
					[lazy]="true"
					[filter]="true"
					[loading]="loadingBrokers"
					[virtualScrollItemSize]="40"
					[showClear]="true"
					class="w-full"
				></p-select>
				<label for="broker">Corretora</label>
			</p-floatlabel>
		</div>
		<div class="field col-12 md:col-6 pt-3">
			<p-floatLabel>
				<p-inputNumber
					formControlName="valuePerShare"
					mode="currency"
					currency="BRL"
					locale="pt-BR"
					minFractionDigits="2"
					maxFractionDigits="6"
					class="w-full"
				></p-inputNumber>
				<label for="valuePerShare">Valor por Cota</label>
			</p-floatLabel>
		</div>
		<div class="field col-12 md:col-6 pt-3">
			<p-floatLabel>
				<p-inputNumber
					formControlName="totalValue"
					mode="currency"
					currency="BRL"
					locale="pt-BR"
					minFractionDigits="2"
					maxFractionDigits="2"
					class="w-full"
				></p-inputNumber>
				<label for="totalValue">Valor Total</label>
			</p-floatLabel>
		</div>
		<div class="field col-12 md:col-6 pt-3">
			<p-floatlabel>
				<p-datepicker
					formControlName="exDate"
					inputId="exDate"
					showIcon
					iconDisplay="input"
					fluid="true"
					appendTo="body"
					dateFormat="dd/mm/yy"
				/>
				<label for="exDate">Ex-Date</label>
			</p-floatlabel>
		</div>
		<div class="field col-12 md:col-6 pt-3">
			<p-floatlabel>
				<p-datepicker
					formControlName="payDate"
					inputId="payDate"
					showIcon
					iconDisplay="input"
					fluid="true"
					appendTo="body"
					dateFormat="dd/mm/yy"
				/>
				<label for="payDate">Pay-Date</label>
			</p-floatlabel>
		</div>
		<div class="field col-12 md:col-6 pt-3">
			<p-floatLabel>
				<p-inputText
					formControlName="currency"
					class="w-full"
				></p-inputText>
				<label for="currency">Moeda</label>
			</p-floatLabel>
		</div>
		<div class="field col-12 md:col-6 pt-3">
			<p-floatLabel>
				<p-inputText
					formControlName="notes"
					class="w-full"
				></p-inputText>
				<label for="notes">Notas</label>
			</p-floatLabel>
		</div>
		<p-divider />
		<div class="field col-12 flex justify-content-end gap-2">
			<button
				pButton
				type="button"
				label="Cancelar"
				icon="pi pi-times"
				class="p-button-secondary"
				(click)="visible = false"
			></button>
			<button
				pButton
				type="button"
				label="Salvar"
				icon="pi pi-check"
				class="p-button-success"
				(click)="saveEvent()"
				[disabled]="eventForm.invalid"
			></button>
		</div>
	</form>
</p-dialog>
