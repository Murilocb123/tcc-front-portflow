<p-dialog
    header="Adicionar carteira"
    [(visible)]="showPortfolioDialog"
    [modal]="true"
    [draggable]="true"
    [resizable]="true"
    styleClass="w-full lg:w-4  sm:w-8"
>
    <form
        #portfolioForm="ngForm"
        (ngSubmit)="addPortfolio(portfolioForm)"
        class="formgrid grid pt-4 pr-3 pl-3 gap-2"
    >
        <div class="field flex justify-content-start w-full">
            <p-floatLabel class="w-full">
                <input pInputText name="name" ngModel required class="w-full" />
                <label for="name">Nome da carteira</label>
            </p-floatLabel>
        </div>
        <div class="flex justify-content-end align-items-end w-full">
            <p-checkbox
                name="isDefault"
                ngModel
                value="true"
                inputId="ingredient1"
                [binary]="true"
            />
            <label for="isDefault" class="ml-2">Definir padrão</label>
        </div>
        <p-divider />
        <div class="field col-12 flex justify-content-end gap-2">
            <button
                pButton
                type="button"
                label="Cancelar"
                icon="pi pi-times"
                class="p-button-secondary"
                (click)="showPortfolioDialog = false"
            ></button>
            <button
                pButton
                type="submit"
                label="Salvar"
                icon="pi pi-check"
                class="p-button-success"
                [disabled]="!portfolioForm.valid"
            ></button>
        </div>
    </form>
</p-dialog>
<header
    class="topbar"
    role="navigation"
    aria-label="Menu superior"
    [ngClass]="darkClass"
>
    <div class="topbar__wrap">
        <div class="topbar__brand">
            <!-- a esquerda -->
            <!-- título/branding do app -->
            <img [src]="'logo_white.svg'" alt="Logo" />
        </div>
        <div class="topbar__portfolio-select">
            <!-- no centro  -->
            <p-select
                [options]="portfolios"
                [(ngModel)]="selectedPortfolio"
                optionLabel="name"
                class="w-full md:w-56"
                (onChange)="onPortfolioChange($event)"
            >
                <ng-template pTemplate="selectedItem" let-selectedOption>
                    <div class="flex items-center gap-2" *ngIf="selectedOption">
                        <div>{{ selectedOption.name }}</div>
                    </div>
                </ng-template>
                <ng-template pTemplate="item" let-portfolio>
                    <div class="flex items-center gap-2">
                        <div>{{ portfolio.name }}</div>
                    </div>
                </ng-template>
                <ng-template pTemplate="dropdownicon">
                    <i class="pi pi-wallet"></i>
                </ng-template>
                <ng-template pTemplate="footer">
                    <div class="p-3">
                        <p-button
                            label="Adicionar carteira"
                            fluid
                            severity="secondary"
                            text
                            size="small"
                            icon="pi pi-plus"
                            (click)="showAddPortfolioDialog()"
                        ></p-button>
                    </div>
                </ng-template>
            </p-select>
        </div>
        <nav class="topbar__nav" aria-label="Ações rápidas">
            <!-- a direita -->
            <div class="topbar__left_item">
                <p-overlaybadge
                    value="0"
                    badgeSize="small"
                    badgeDisabled="true"
                >
                    <button
                        #notificationButton
                        pButton
                        icon="pi pi-bell"
                        class="notification-button"
                        aria-label="Notificações"
                        (click)="openNotificationPanel($event)"
                        [rounded]="true"
                    ></button>
                </p-overlaybadge>
                <!-- um botão com nome e email do usuario logado e foto de perfil com components do primeng com bordas arredondadas -->
                <button
                    pButton
                    class="user-info"
                    (click)="toggleUserPopover($event)"
                    rounded="true"
                    icon="pi pi-user"
                    [label]="username"
                ></button>
                <p-popover #userPopover>
                    <div class="flex flex-column gap-4">
                        <div>
                            <span class="font-medium block mb-2 text-center"
                                >Ações</span
                            >
                            <hr />
                            <!-- quero uma lista com uma opção de mudar de tema e outra de sair deverao ser links tag <a> um em cima do outro com icone -->
                            <div class="flex flex-column gap-2">
                                <!-- <a
                                    class="action_list_itens"
                                    (click)="toggleTheme()"
                                >
                                    <i
                                        class="pi pi-fw pi-adjust"
                                        style="font-size: 1.2rem"
                                    ></i>
                                    Mudar tema
                                </a> -->
                                <a class="action_list_itens" (click)="logout()">
                                    <i
                                        class="pi pi-fw pi-sign-out"
                                        style="font-size: 1.2rem"
                                    ></i>
                                    Sair
                                </a>
                            </div>
                        </div>
                    </div>
                </p-popover>
            </div>
        </nav>
    </div>
</header>

<p-popover #popover>
    <div class="gap-4">
        <div>
            <span class="font-medium block mb-2">Notificações</span>
            <ul
                class="list-none p-0 m-0"
                *ngIf="notifications.length; else noNotifications"
            >
                <li
                    *ngFor="let notification of notifications; let last = last"
                    class="flex items-center gap-2 p-2 hover:bg-emphasis cursor-pointer rounded-border"
                    [ngStyle]="
                        !last
                            ? {
                                  'border-bottom': '1px solid #e0e0e0',
                              }
                            : {}
                    "
                >
                    <div>
                        <span class="font-medium">{{
                            notification.title
                        }}</span>
                        <div
                            class="text-sm text-surface-500 dark:text-surface-400"
                        >
                            {{ notification.message }}
                        </div>
                    </div>
                </li>
            </ul>
            <ng-template #noNotifications>
                <div class="text-sm text-surface-500 dark:text-surface-400">
                    Nenhuma notificação
                </div>
            </ng-template>
        </div>
    </div></p-popover
>
